@model CalendarioGerarOrg.Models.calendario
@{
    ViewData["Title"] = "";
}
<div id="loader" style="display:none"></div>
<div id="mypanel">
    <h4>Calendário</h4>
    <h5><a asp-controller="Calendario" asp-action="Portaria723">Portaria 671</a></h5>
    <hr />
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    <div class="row">
        <div class="col-md-4" style="min-width:390px">
            <div class="form-group col-md-12">
                <label class="control-label">Local</label>
                <select class="form-control update" data-live-search="true" asp-for="idcidade" asp-items="ViewBag.cidade"></select>
            </div>
            <div class="form-group">
                <div class="form-group col-md-6">
                    <label class="control-label">Empresa</label>
                    <input type="text" asp-for="empresa" class="form-control" />
                </div>
                <div class="form-group col-md-6">
                    <label class="control-label">Aprendiz</label>
                    <input type="text" asp-for="aprendiz" class="form-control" />
                </div>
            </div>
            <div class="form-group">
                <div class="form-group col-md-6">
                    <label class="control-label">Data Inicial</label>
                    <input type="date" asp-for="datainicial" class="form-control " onblur="UpdateCalendario();" />
                </div>
                <div class="form-group col-md-6">
                    <label class="control-label">Data Final</label>
                    <label class="checkbox-inline gruporeducao" style="padding-left:40px"><input type="checkbox" id="datafixa" onclick="$('#datafinal').prop('readonly', !$('#datafinal').prop('readonly'));UpdateCalendario()">Fixa</label>
                    <input type="date" asp-for="datafinal" class="form-control " readonly onblur="UpdateCalendario();" />
                </div>

            </div>

        </div>
        <div class="col-sm-4">
            <div class="form-group">
                <div class="form-group col-md-4">
                    <label class="control-label">Dia&nbsp;Teoria</label>
                    <select class="form-control update" asp-for="semanateoria" onchange="return checkdiafolga()">
                        <option value="1">Segunda</option>
                        <option value="2">Terça</option>
                        <option value="3">Quarta</option>
                        <option value="4">Quinta</option>
                        <option value="5">Sexta</option>

                    </select>

                </div>
                <div class="form-group col-md-4">
                    <label class="control-label">Carga&nbsp;Horária</label>
                    <select class="form-control" asp-for="cargahoraria" onchange="cargahorariaChange()">
                        <!--
                        <option value="0">4h (20h 17m)</option>
                        <option value="1">4h (20h 24m)</option>
                        <option value="2">6h (30h 11m)</option>
                        <option value="3">6h (30h 15m)</option>
                        -->
                        <option value="6">4h (20h 24m)</option>
                        <option value="7">6h (30h 18m)</option>
                        <option value="4">4h Aberto</option>
                        <option value="5">6h Aberto</option>
                        
                    </select>
                </div>

                <div class="form-group col-md-4">
                    <label class="control-label">Dia&nbsp;Folga</label>
                <select class="form-control update" asp-for="diafolga" onchange="return checkdiafolga()">
                        <option value="1">Segunda</option>
                        <option value="2">Terça</option>
                        <option value="3">Quarta</option>
                        <option value="4">Quinta</option>
                        <option value="5">Sexta</option>
                        <option value="6">Sábado</option>
                        <!--<option value="7">Domingo</option>-->

                    </select>
                </div>

            </div>
            <div class="form-group">
                <div class="form-group col-md-6">
                    <label class="control-label">Carga Teoria</label>
                    <input class="form-control update" asp-for="cargateorica" readonly  min="1" max="5000" step="1"/>
                </div>
                <div class="form-group col-md-6">
                    <label class="control-label">Carga Prática</label>
                    <input class="form-control update" asp-for="cargapratica" readonly  min="1" max="5000" step="1"/>
                </div>
            </div>
            <div class="form-group">
                <div class="form-group col-md-6">
                    <label class="control-label">Total Meses</label>
                    <input class="form-control update" id="mesestotal" readonly type="number" />
                </div>
                <div class="form-group col-md-5">
                    <label class="control-label">Carga Inicial</label>
                    <input class="form-control" id="cargainicial" readonly type="text" />
                </div>
                <div class="form-group col-md-1">
                    <label class="control-label">&nbsp;</label><br />
                    <button type="button" class="btn btn-xs btn-primary" id="btnPrint">
                        <span style="font-size:16px;" class="glyphicon glyphicon-print"></span>
                    </button>
                </div>
            </div>
           
        </div>
        <div class="col-sm-10">
            <datainput style="display:none" v-bind:datas="iniciais" title="Semanas iniciais" @@listchange="this.calendario.iniciais=todos=$event;this.UpdateCalendario()"></datainput>
            <div class="col-sm-4" style="min-width:420px">
                <div class="form-group ">
                    <label class="control-label">Semanas iniciais</label>
                    <div class="input-group">
                        <input type="date" class="form-control" placeholder="Início" id="datainicialI" onchange="$('#datainicialF').val( $(this).val()) " />
                        <span class="input-group-addon">-</span>
                        <input type="date" class="form-control" placeholder="Fim" id="datainicialF" />
                        <span class="input-group-addon " onclick="AddInicial()"><span class="glyphicon glyphicon-plus"></span></span>
                    </div>

                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div id="calendarinicial" style="overflow-y:auto;max-height:250px;overflow-x:initial"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4" style="min-width:420px">
                <div class="form-group ">
                    <label class="control-label">Encontro complementares Online</label>
                    <div class="input-group">
                        <input type="date" class="form-control" placeholder="Início" id="dataextraI" onchange="$('#dataextraF').val( $(this).val())" />
                        <span class="input-group-addon">-</span>
                        <input type="date" class="form-control" placeholder="Fim" id="dataextraF" />
                        <span class="input-group-addon " onclick="AddExtra()"><span class="glyphicon glyphicon-plus"></span></span>
                    </div>

                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div id="calendarextra" style="overflow-y:auto;max-height:250px;overflow-x:initial"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4" style="min-width:420px">
                <div class="form-group ">
                    <label class="control-label">Período de férias</label>
                    <div class="input-group">
                        <input type="date" class="form-control" placeholder="Início" id="dataferiasI" onchange="$('#dataferiasF').val( $(this).val())" />
                        <span class="input-group-addon">-</span>
                        <input type="date" class="form-control" placeholder="Fim" id="dataferiasF" />
                        <span class="input-group-addon " onclick="AddFerias()"><span class="glyphicon glyphicon-plus"></span></span>
                    </div>

                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div id="calendarferias" style="overflow-y:auto;max-height:250px;overflow-x:initial"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 hidden" id="suspensaodiv" style="min-width:420px">
                <div class="form-group">
                    <label class="control-label">Período de suspensão</label>
                    <label class="checkbox-inline gruporeducao" style="padding-left:40px"><input type="checkbox" id="estabilidadesuspencao" onclick="UpdateCalendario();">Estabilidade por suspensão</label>
                    <div class="input-group">
                        <input type="date" class="form-control" placeholder="Início" id="datasuspensaoI" onchange="$('#datasuspensaoF').val( $(this).val())" />
                        <span class="input-group-addon">-</span>
                        <input type="date" class="form-control" placeholder="Fim" id="datasuspensaoF" />
                        <span class="input-group-addon " onclick="AddSuspensao()"><span class="glyphicon glyphicon-plus"></span></span>
                    </div>

                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div id="calendarsuspensao" style="overflow-y:auto;max-height:250px;overflow-x:initial"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 gruporeducao hidden" style="min-width:420px">
                <div class="form-group ">
                    <label class="control-label">Período de redução</label>
                    <div class="input-group">
                        <label class="radio-inline" onclick="updatereducao();"><input type="radio" name="reducaoper" id="reducaoper" checked value="0">sem redução</label>
                        <label class="radio-inline" onclick="updatereducao();"><input type="radio" name="reducaoper" id="reducaoper" value="25">25 %</label>
                        <label class="radio-inline" onclick="updatereducao();"><input type="radio" name="reducaoper" id="reducaoper" value="50">50 %</label>
                        <label class="radio-inline" onclick="updatereducao();"><input type="radio" name="reducaoper" id="reducaoper" value="70">70 %</label>

                    </div>
                    <div class="input-group " style="display:none" id="reducaodiv">
                        <input type="date" class="form-control datareducaoI" placeholder="Início" id="datareducaoI" onchange="$('#datareducaoF').val($(this).val()); updatereducao();" />
                        <span class="input-group-addon">-</span>
                        <input type="date" class="form-control datareducaoF" placeholder="Fim" id="datareducaoF" onchange="updatereducao();" />

                    </div>

                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div id="calendarsuspensao" style="overflow-y:auto;max-height:250px;overflow-x:initial"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 gruporeducao hidden" style="min-width:420px">
                <div class="form-group ">
                    <label class="control-label">Período de teórico</label>
                    <div class="input-group">
                        <input type="date" class="form-control" placeholder="Início" id="datateoricoI" onchange="$('#datateoricoF').val( $(this).val())" />
                        <span class="input-group-addon">-</span>
                        <input type="date" class="form-control" placeholder="Fim" id="datateoricoF" />
                        <span class="input-group-addon " onclick="AddTeorico()"><span class="glyphicon glyphicon-plus"></span></span>
                    </div>

                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div id="calendarteorico" style="overflow-y:auto;max-height:250px;overflow-x:initial"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 gruporeducao hidden" style="min-width:420px">
                <div class="form-group ">
                    <label class="control-label">Período de prática</label>
                    <div class="input-group">
                        <input type="date" class="form-control" placeholder="Início" id="datapraticaI" onchange="$('#datapraticaF').val( $(this).val())" />
                        <span class="input-group-addon">-</span>
                        <input type="date" class="form-control" placeholder="Fim" id="datapraticaF" />
                        <span class="input-group-addon " onclick="AddPratica()"><span class="glyphicon glyphicon-plus"></span></span>
                    </div>

                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div id="calendarpratica" style="overflow-y:auto;max-height:250px;overflow-x:initial"></div>
                    </div>
                </div>
            </div>

            <div class="col-sm-4 gruporeducao hidden" style="min-width:420px">
                <div class="form-group ">
                    <label class="control-label">Estabilidade prática</label>

                    <div class="input-group">
                        <input type="date" class="form-control" placeholder="Início" id="dataestabilidadepraticaI" onchange="$('#dataestabilidadepraticaF').val( $(this).val())" />
                        <span class="input-group-addon">-</span>
                        <input type="date" class="form-control" placeholder="Fim" id="dataestabilidadepraticaF" />
                        <span class="input-group-addon " onclick="AddestabilidadePratica()"><span class="glyphicon glyphicon-plus"></span></span>
                    </div>

                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div id="calendarestabilidadepratica" style="overflow-y:auto;max-height:250px;overflow-x:initial"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 gruporeducao hidden" style="min-width:420px">
                <div class="form-group ">
                    <label class="control-label">Estabilidade teórica</label>
                    <div class="input-group">
                        <input type="date" class="form-control" placeholder="Início" id="dataestabilidadeteoricaI" onchange="$('#dataestabilidadeteoricaF').val( $(this).val())" />
                        <span class="input-group-addon">-</span>
                        <input type="date" class="form-control" placeholder="Fim" id="dataestabilidadeteoricaF" />
                        <span class="input-group-addon " onclick="AddestabilidadeTeorica()"><span class="glyphicon glyphicon-plus"></span></span>
                    </div>

                </div>
                <div class="form-group">
                    <div class="input-group">
                        <div id="calendarestabilidadeteorica" style="overflow-y:auto;max-height:250px;overflow-x:initial"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="panel panel-default">
    <div class="panel-heading">
        Calendar
        <button type="button" class="btn btn-xs btn-primary" id="btnLoad" style="float:right;display:none" onclick="$('#Fcalendarbkp').click();">
            <span style="font-size:16px;" class="glyphicon glyphicon-open"></span>
        </button>
        <input type="file"
               id="Fcalendarbkp" name="Fcalendarbkp" style="display:none" accept="application/JSON, text/plain">
        <button type="button" class="btn btn-xs btn-primary" id="btnSave" style="float:right;margin-right:10px;display:none" onclick="download(JSON.stringify(calendario), 'calendarbkp.txt', 'text/plain');">
            <span style="font-size:16px;" class="glyphicon glyphicon-save"></span>
        </button>
        <button type="button" class="btn btn-xs btn-primary" id="btnLog" style="float:right;margin-right:10px;" onclick="log();" title="Gerar Log">
            <span style="font-size:16px;" class="glyphicon glyphicon-list-alt"></span>
        </button>
    </div>
    <div>
        <div class="panel-body">
            <div id="print" style="max-width:730px;">
                <div id="calendar" class="calendar" style="overflow: visible;height:auto">
                </div>
                <div id="ledenda" style="padding-left:25px;font-size:10px">
                   &nbsp;&nbsp;
                    <table border="0" style="display: table; border-collapse: separate;  border-spacing: 5px;  border-color: gray; border: 1px solid rgb(221, 221, 221);">
                        <tr style="height:15px">
                            <td style="width:14px" class="teorica">&nbsp;&nbsp;</td>
                            <td>Teóricas</td>
                            <td style="width:16px" class="pratica">&nbsp;&nbsp;</td>
                            <td>Práticas</td>
                            <td style="width:16px" class="recesso">&nbsp;&nbsp;</td>
                            <td>Recesso&nbsp;prático&nbsp;e&nbsp;teórico </td>
                            <td style="width:16px" class="recessogerar">&nbsp;&nbsp;</td>
                            <td>Recesso&nbsp;Gerar</td>
                            <td style="width:18px" class="feriado">&nbsp;&nbsp;</td>
                            <td>Feriados</td>
                            <td style="width:16px" class="ferias">&nbsp;&nbsp;</td>
                            <td>Férias</td>
                            <td style="width:16px" class="suspensao">&nbsp;&nbsp;</td>
                            <td>Suspensão</td>
                            <td style="width:16px" class="extra">&nbsp;&nbsp;</td>
                            <td>Encontro&nbsp;Online</td>
                            
                        </tr>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>
@section Scripts {

    <link href="~/css/bootstrap-year-calendar.min.css" rel="stylesheet" />
    <script src="~/js/bootstrap-year-calendar.min.js"></script>
    <script src="~/js/bootstrap-year-calendar.pt.js"></script>
    <!-- <script src="~/js/html2canvas.min.js"></script>-->
    <link href="~/css/bootstrap-select.min.css" rel="stylesheet" />
    <script src="~/js/bootstrap-select.min.js"></script>
    <script src="~/js/i18n/defaults-pt_BR.js"></script>
    <script src="~/pdfmake.min.js?v=2"></script>
    <script src="~/vfs_fonts.js?v=2"></script>
    <script src="~/js/xlsx.full.min.js"></script>
    <script src="~/js/dom-to-image.min.js"></script>
    
    <style>

        .feriado1 {
            /*background-color: rgb(255, 0, 0);
            border-radius: 15px;*/
            color: burlywood;
            pointer-events: none;
        }

        .recessogerar1 {
            /*pointer-events: none; */
            background-image: url('../img/asterisco.png');
            background-repeat: no-repeat;
            background-position: center center;
            background-size: 70% 70%, auto;
        }

        .recesso {
            /*background-image: linear-gradient(to right, rgba(169,169,169,1), rgba(0,0,0,0));*/
            /*pointer-events: none;*/
            background-image: url('../img/triangle.png');
            background-repeat: no-repeat;
            background-position: center center;
            background-size: 80% 80%, auto;
        }

        .feriado {
            pointer-events: none;
            background-image: url('../img/redcorss.svg');
            background-repeat: no-repeat;
            background-position: center center;
            background-size: 60% 60%, auto;
        }

        td.ferias {
            background-image: url('../img/red-line-png.png');
            background-repeat: repeat-x;
            background-position: center;
        }

        td.suspensao {
            background-image: url('../img/sus-line-png.png');
            background-repeat: no-repeat;
            background-position: center center;
            background-size: 80% 80%, auto;
        }

        td.reducao {
            background-image: url('../img/blue-half-line-png.png');
            background-repeat: no-repeat;
            background-position: center center;
            background-size: 80% 80%, auto;
        }

        .teorica {
            background-color: rgb(44, 143, 201);
            color: white;
        }

        td.pratica {
            background-image: url('../img/blue-line-png.png');
            background-repeat: repeat-x;
            background-position: bottom;
            /*
                background-size: 1px 4px;
                box-shadow: rgb(44, 143, 201) 0px -4px 0px 0px inset;
                border-bottom: 0.5px solid rgb(44, 143, 201);
                text-decoration: underline;
                box-shadow: rgb(44, 143, 201) 0px -4px 0px 0px inset;

            text-decoration-color: rgb(44, 143, 201);
                */
        }
         .extra {
           pointer-events: none;
    background-image: url(../img/vecteezy_computer_1203930.png);
    background-repeat: no-repeat;
    background-position: 10% 67%;
    background-size: 95% 72%, auto;
        }
        td.extra {
               background-position: 40%;
    
        }
    </style>
    <script>
        var currentYear = new Date().getFullYear();
        var dd = [];
        var calendar;
        var calendario = {
            idcidade: '',
            datainicial: '',
            datafinal: '',
            semanateoria: '',
            feriados: [],
            suspensao: [],
            teoricas: [],
            praticas: [],
            extras: [],
            iniciais: [],
            ferias: [],
            manuaisteorica: [],
            manuaispratica: [],
            reducao:[]
        };
        $(function () {
            //if (currentYear < 2019) { currentYear = 2019; }//acerto inicial remover depois de 2019
            UpdateCalendario(true);

            $(".update").change(function () {
                UpdateCalendario();
            });
            $('#idcidade').selectpicker();

            $("#btnPrint").click(function () {
                showLoader();
                CanvasYears();
            });
            if(!window.location.href.includes('LKGJLKSAJDLKSD')){
                $("#cargahoraria option[value=4]").hide();
                $("#cargahoraria option[value=5]").hide();
            }
        });

        function renderEvent(event) {
            $('.prev, .year-neighbor2, .year-neighbor, .next').attr("data-html2canvas-ignore", "true");
            addCH();
           // setTimeout(function () { PrintDiv(document.querySelector("#print"));}, 5000);
        }
        function clickDay(event) {
            if (event.date.getDay() == 0 || event.date.getDay() == 6) return; // naum para finais de semana
            //manuaisteorica: [],
            //manuaispratica: []
            var jsondata = event.date.toJSON();
            jsondata = jsondata.substring(0, jsondata.indexOf("T")) + "T00:00:00";


            if (event.element.hasClass('pratica')) {
                event.element.removeClass('pratica');
                calendario.manuaispratica = calendario.manuaispratica.filter(p => p != jsondata); //CalcHoras();
                return;
            }

            if (!event.element.hasClass('teorica')) {
                event.element.addClass('teorica');
                calendario.manuaisteorica.push(jsondata)

            } else {
                event.element.removeClass('teorica');
                event.element.addClass('pratica');
                calendario.manuaisteorica = calendario.manuaisteorica.filter(p => p != jsondata );
                calendario.manuaispratica.push(jsondata);
            }
            //CalcHoras();
        }

        function customDayRenderer(element, date) {

            //date.setDate(date.getDate() + 1);
            date.setHours(0, 0, 0, 0);
            var jsondata = date.toJSON();
            jsondata = jsondata.substring(0, jsondata.indexOf("T")) + "T00:00:00";

            //recessos gerar
            if (calendario.recessosgerar.includes(jsondata)) {
                $(element).parent().addClass('recessogerar');
                $(element).attr('title', 'Recesso Gerar');
            }
            //recessos

            var rec = calendario.recessos.find(function (rec) {
                return rec.dia == jsondata;
            });
            //if (calendario.recessos.includes(jsondata))
            if (rec!=null)
            {
                var rectitle = 'Recesso';
                $(element).parent().addClass('recesso');
                switch (rec.tipo) {
                    case 0:
                        rectitle = 'Semanas iniciais';
                        break;
                    case 1:
                        rectitle = 'Encontro complementares Online';
                        break;
                    case 2:
                        rectitle = 'Recesso regular';
                        break;
                    default:
                        ''
                }
                $(element).attr('title', rectitle);
            }
            else
            //feriados
            if (calendario.feriados.includes(jsondata))
                $(element).parent().addClass('feriado');
            else
            //extras online
            if (calendario.extrasdias.includes(jsondata) )
            { 
                //calendario.extras
                $(element).parent().addClass('extra'); 
            }
            else
            //teoricas
            if (calendario.teoricas.includes(jsondata) || calendario.manuaisteorica.includes(jsondata))
            { 
                //calendario.extras
                $(element).parent().addClass('teorica'); 
            }
            else
            //praticas
            if (calendario.praticas.includes(jsondata) || calendario.manuaispratica.includes(jsondata))
                    $(element).parent().addClass('pratica');
            else
            //suspensao
                if (calendario.suspensaodias.includes(jsondata))
                    $(element).parent().addClass('suspensao');
                else
                    //reducao
                    if (calendario.reducaodias.includes(jsondata) && $('#reducaoper:checked').val()>0)
                $(element).parent().addClass('reducao');
            else
            //ferias
            if (calendario.feriasdias.includes(jsondata))
                     $(element).parent().addClass('ferias');

        }

        function UpdateCidade() {

            $.get("@Url.Action("GetFeriados")", { idcidade: $("#idcidade").val() })
                .done(function (data) {
                    dd = [];
                    for (var x in data) {
                        dd.push((new Date(data[x])).getTime());
                    }
                    $('#calendar').data('calendar')._render();
                });
        }
        function updatereducao() {

            $('#reducaodiv').hide(); $('#suspensaodiv').removeClass('disabledbutton');
            $('#reducaodiv').show(); $('#suspensaodiv').addClass('disabledbutton');
            if ($('#reducaoper:checked').val() == '0') {
                $('#reducaodiv').hide(); $('#suspensaodiv').removeClass('disabledbutton');
                UpdateCalendario();

            } else {
                $('#reducaodiv').show(); $('#suspensaodiv').addClass('disabledbutton');
                if ($('#datareducaoI').val() != '' && $('#datareducaoF').val() != '') {

                    document.getElementById("datateoricoI").setAttribute("min", $('#datareducaoI').val());
                    document.getElementById("datateoricoI").setAttribute("max", $('#datareducaoF').val());
                    document.getElementById("datateoricoF").setAttribute("min", $('#datareducaoI').val());
                    document.getElementById("datateoricoF").setAttribute("max", $('#datareducaoF').val());

                    document.getElementById("datapraticaI").setAttribute("min", $('#datareducaoI').val());
                    document.getElementById("datapraticaI").setAttribute("max", $('#datareducaoF').val());
                    document.getElementById("datapraticaF").setAttribute("min", $('#datareducaoI').val());
                    document.getElementById("datapraticaF").setAttribute("max", $('#datareducaoF').val());

                    UpdateCalendario();
                }

            }



        }
        function UpdateCalendario(draw=false) {


            calendario = {
                idcidade: $('#idcidade').val(),
                datainicial: $('#datainicial').val(),
                datafinal: $('#datafinal').val(),
                semanateoria: $('#semanateoria').val(),
                cargahoraria: $('#cargahoraria :selected').val(),
                praticas: calendario.praticas,
                teoricas: calendario.teoricas,
                manuaispratica: calendario.manuaispratica,
                manuaisteorica: calendario.manuaisteorica,
                reducao: calendario.reducaod,
                reducaoper: $('#reducaoper:checked').val(),
                datafixa: $('#datafixa').is(':checked'),
                estabilidadesuspencao: $('#estabilidadesuspencao').is(':checked'),
                iniciais: calendario.iniciais,
                cargateorica:$('#cargateorica').val(),
                cargapratica:$('#cargapratica').val(),
                diafolga:$('#diafolga').val()
            };
            UpdateExtra();
            $.post("@Url.Action("GetCalendario")", { cal:calendario })
                .done(function (data) {
                    calendario = data;
                    if (calendario.manuaisteorica == undefined) calendario.manuaisteorica = [];
                    if (calendario.manuaispratica == undefined) calendario.manuaispratica = [];
                    if (calendario.feriasdias == undefined) calendario.feriasdias = [];
                    if (calendario.reducaodias == undefined) calendario.reducaodias = [];
                    if (!draw) { $('#calendar').data('calendar')._render(); }
                    else {
                        calendar=$('#calendar').calendar({
                        startYear: currentYear,
                        language: 'pt',
                        renderEnd: renderEvent,
                        //clickDay: clickDay,
                        customDayRenderer: customDayRenderer
                    });
                    }

                    $('#datafinal').val(calendario.datafinal.substring(0, calendario.datafinal.indexOf("T")) );
                    $('#cargateorica').val(calendario.cargateorica);
                    $('#cargapratica').val(calendario.cargapratica);
                    $('#mesestotal').val(calendario.mesestotal);
                    $('#cargainicial').val(Number.parseFloat(calendario.cargainicial).toFixed(1) + ' %  ' + calendario.cargainicialhoras +' hs');

                    var mesestotal = 0;
                    switch ($('#cargahoraria :selected').val()) {
                        case '0':
                            mesestotal = 17;
                            break;
                        case '1':
                            mesestotal = 24;
                            break;
                        case '2':
                            mesestotal = 11;
                            break;
                        case '3':
                            mesestotal = 15;
                            break;
                        case '6':
                            mesestotal = 24;
                            break;
                        case '7':
                            mesestotal = 18;
                            break;
                    }


                    if (calendario.mesestotal < mesestotal)
                        $('#mesestotal').css('color', '');
                    else
                        $('#mesestotal').css('color', 'red');

                    if (calendario.cargainicial < 10  || calendario.cargainicial > 20)
                        $('#cargainicial').css('color', 'red');
                    else
                        $('#cargainicial').css('color', '');
                    //CalcHoras();
                    //addCH();
                })
                .fail(function(xhr, status, error) {
                    alert('Erro de validação verifique os dados do calendário');
                    calendario.praticas=[];
                    calendario.teoricas=[];
                    UpdateCalendario(draw);
                });
                ;

        }

        function AddExtra() {
            if ($('#dataextraI').val().length > 0 && $('#dataextraF').val().length > 0)
            {
                $('#calendarextra').append('<div class="input-group"><input type="date" class="form-control dataI" readonly placeholder="Início" id="dataextraI" value="' + $('#dataextraI').val() + '"><span class="input-group-addon">-</span><input type="date" class="form-control dataF" readonly placeholder="Fim" id="dataextraF" value="' + $('#dataextraF').val() + '"><span class="input-group-addon" onclick="RemoveExtra(this)"><span class="glyphicon glyphicon-minus" ></span></span></div>');
                UpdateCalendario();
            }
        }

        function AddInicial() {
            if ($('#datainicialI').val().length > 0 && $('#datainicialF').val().length > 0) {
                $('#calendarinicial').append('<div class="input-group"><input type="date" class="form-control datainicialI" readonly placeholder="Início" id="datainicialI" value="' + $('#datainicialI').val() + '"><span class="input-group-addon">-</span><input type="date" class="form-control datainicialF" readonly placeholder="Fim" id="datainicialF" value="' + $('#datainicialF').val() + '"><span class="input-group-addon" onclick="RemoveExtra(this)"><span class="glyphicon glyphicon-minus" ></span></span></div>');
                UpdateCalendario();
            }
        }

        function AddFerias() {
            if ($('#dataferiasI').val().length > 0 && $('#dataferiasF').val().length > 0) {
                $('#calendarferias').append('<div class="input-group"><input type="date" class="form-control dataferiasI" readonly placeholder="Início" id="dataferiasI" value="' + $('#dataferiasI').val() + '"><span class="input-group-addon">-</span><input type="date" class="form-control dataferiasF" readonly placeholder="Fim" id="dataferiasF" value="' + $('#dataferiasF').val() + '"><span class="input-group-addon" onclick="RemoveExtra(this)"><span class="glyphicon glyphicon-minus" ></span></span></div>');
                UpdateCalendario();
            }
        }

        function AddSuspensao() {
            if ($('#datasuspensaoI').val().length > 0 && $('#datasuspensaoF').val().length > 0) {
                $('#calendarsuspensao').append('<div class="input-group"><input type="date" class="form-control datasuspensaoI" readonly placeholder="Início" id="datasuspensaoI" value="' + $('#datasuspensaoI').val() + '"><span class="input-group-addon">-</span><input type="date" class="form-control datasuspensaoF" readonly placeholder="Fim" id="datasuspensaoF" value="' + $('#datasuspensaoF').val() + '"><span class="input-group-addon" onclick="RemoveExtra(this)"><span class="glyphicon glyphicon-minus" ></span></span></div>');
                UpdateCalendario();
            }
        }
        function AddTeorico() {
            if ($('#datateoricoI').val().length > 0 && $('#datateoricoF').val().length > 0) {
                $('#calendarteorico').append('<div class="input-group"><input type="date" class="form-control datateoricoI" readonly placeholder="Início" id="datateoricoI" value="' + $('#datateoricoI').val() + '"><span class="input-group-addon">-</span><input type="date" class="form-control datateoricoF" readonly placeholder="Fim" id="datasuspensaoF" value="' + $('#datateoricoF').val() + '"><span class="input-group-addon" onclick="RemoveExtra(this)"><span class="glyphicon glyphicon-minus" ></span></span></div>');
                UpdateCalendario();
            }
        }
        function AddPratica() {
            if ($('#datapraticaI').val().length > 0 && $('#datapraticaF').val().length > 0) {
                $('#calendarpratica').append('<div class="input-group"><input type="date" class="form-control datapraticaI" readonly placeholder="Início" id="datapraticaI" value="' + $('#datapraticaI').val() + '"><span class="input-group-addon">-</span><input type="date" class="form-control datapraticaF" readonly placeholder="Fim" id="datapraticaF" value="' + $('#datapraticaF').val() + '"><span class="input-group-addon" onclick="RemoveExtra(this)"><span class="glyphicon glyphicon-minus" ></span></span></div>');
                UpdateCalendario();
            }
        }

        function AddestabilidadeTeorica() {
            if ($('#dataestabilidadeteoricaI').val().length > 0 && $('#dataestabilidadeteoricaF').val().length > 0) {
                $('#calendarestabilidadeteorica').append('<div class="input-group"><input type="date" class="form-control dataestabilidadeteoricaI" readonly placeholder="Início" id="dataestabilidadeteoricaI" value="' + $('#dataestabilidadeteoricaI').val() + '"><span class="input-group-addon">-</span><input type="date" class="form-control dataestabilidadeteoricaF" readonly placeholder="Fim" id="datasuspensaoF" value="' + $('#dataestabilidadeteoricaF').val() + '"><span class="input-group-addon" onclick="RemoveExtra(this)"><span class="glyphicon glyphicon-minus" ></span></span></div>');
                UpdateCalendario();
            }
        }
        function AddestabilidadePratica() {
            if ($('#dataestabilidadepraticaI').val().length > 0 && $('#dataestabilidadepraticaF').val().length > 0) {
                $('#calendarestabilidadepratica').append('<div class="input-group"><input type="date" class="form-control dataestabilidadepraticaI" readonly placeholder="Início" id="dataestabilidadepraticaI" value="' + $('#dataestabilidadepraticaI').val() + '"><span class="input-group-addon">-</span><input type="date" class="form-control dataestabilidadepraticaF" readonly placeholder="Fim" id="datapraticaF" value="' + $('#dataestabilidadepraticaF').val() + '"><span class="input-group-addon" onclick="RemoveExtra(this)"><span class="glyphicon glyphicon-minus" ></span></span></div>');
                UpdateCalendario();
            }
        }

        function RemoveExtra(el){
            $(el).parent().remove();
            UpdateCalendario();
        }

        function UpdateExtra() {
            calendario.extras = [];
            $('.dataI').get().forEach(function (entry, index, array) {
                // Here, array.length is the total number of items
                calendario.extras.push({ datainicial: $(entry).val(), datafinal: $('.dataF').eq(index).val()});
            });
            calendario.iniciais= [];
            $('.datainicialI').get().forEach(function (entry, index, array) {
                calendario.iniciais.push({ datainicial: $(entry).val(), datafinal: $('.datainicialF').eq(index).val() });
            });
            calendario.ferias = [];
            $('.dataferiasI').get().forEach(function (entry, index, array) {
                calendario.ferias.push({ datainicial: $(entry).val(), datafinal: $('.dataferiasF').eq(index).val() });
            });
            calendario.suspensao = [];
            $('.datasuspensaoI').get().forEach(function (entry, index, array) {
                calendario.suspensao.push({ datainicial: $(entry).val(), datafinal: $('.datasuspensaoF').eq(index).val() });
            });
            calendario.manuaisteorica = [];
            $('.datateoricoI').get().forEach(function (entry, index, array) {
                calendario.manuaisteorica.push({ datainicial: $(entry).val(), datafinal: $('.datateoricoF').eq(index).val() });
            });
            calendario.manuaispratica = [];
            $('.datapraticaI').get().forEach(function (entry, index, array) {
                calendario.manuaispratica.push({ datainicial: $(entry).val(), datafinal: $('.datapraticaF').eq(index).val() });
            });
            calendario.reducao = []
            $('.datareducaoI').get().forEach(function (entry, index, array) {
                calendario.reducao.push({ datainicial: $(entry).val(), datafinal: $('.datareducaoF').eq(index).val() });
            });
            calendario.estabilidadepraticas = []
            $('.dataestabilidadepraticaI').get().forEach(function (entry, index, array) {
                calendario.estabilidadepraticas.push({ datainicial: $(entry).val(), datafinal: $('.dataestabilidadepraticaF').eq(index).val() });
            });
            calendario.estabilidadeteoricas = []
            $('.dataestabilidadeteoricaI').get().forEach(function (entry, index, array) {
                calendario.estabilidadeteoricas.push({ datainicial: $(entry).val(), datafinal: $('.dataestabilidadeteoricaF').eq(index).val() });
            });

        }

        /*function CalcHoras() {

            var teoricas = calendario.manuaisteorica.length + calendario.teoricas.length;
            var praticas = calendario.manuaispratica.length + calendario.praticas.length;
            $('#cargapratica').val(praticas* $('#cargahoraria').val());
            $('#cargateorica').val(teoricas* $('#cargahoraria').val());

        }
        */
        function GetYears() {


            //new Set(calendario.praticas.map(p => p.substring(0, 4)));

        }

        

        function PrintDiv(div) {

            //style = "width:800px;"
            html2canvas(div, {
                //windowWidth: 1200 //,height: 1200
            }).then(canvas => {
                //document.body.appendChild(canvas)
                //$("#print").width('');
                var myImage = canvas.toDataURL();
                var filename = 'Calendario_' + $('#idcidade :selected').text() + '_' + $('#calendar').data('calendar').getYear() + '.png';
                downloadURI(myImage, filename);

            });
        }

        function downloadURI(uri, name) {
            var link = document.createElement("a");

            link.download = name;
            link.href = uri;
            document.body.appendChild(link);
            link.click();
            //after creating link you should delete dynamic link
            //clearDynamicLink(link);
        }

        var anoscanvas = [];
        var calendariocanvas = [];
        function CanvasYears() {
            anoscanvas = [];
            calendariocanvas = [];
            var anoi = $('#datainicial').val().split('-')[0]
            var anof = $('#datafinal').val().split('-')[0]
            for (ano = anoi; ano <= anof; ano++) {
                anoscanvas.push(ano);
            }
            if (anoscanvas.length > 0)
                CanvasYear(anoscanvas[0]);


        }
        function CanvasYear(ano) {

            if (calendar.getYear() != ano) {
                calendar.setYear(ano);
                setTimeout(function () {
                    //console.log('canvasprint');
                    CanvasYearPrint();
                }, 500);
            } else {
                    CanvasYearPrint();
            }

        }

        function CanvasYearPrint() {
            var div = document.querySelector("#print");

            domtoimage.toPng(div, { bgcolor: 'transparent'  })
                .then(function (dataUrl) {
                    calendariocanvas.push(dataUrl);
                    anoscanvas.shift();
                    if (anoscanvas.length > 0) {
                        CanvasYear(anoscanvas[0]);
                    }
                    else {
                        //console.log('acabou ! manda print');
                        PrintTwo();
                    }

                })
                .catch(function (error) {
                    console.error('oops, something went wrong!', error);
                });

        }
        function CanvasYearPrint1() {
            var div = document.querySelector("#print");
            html2canvas(div, { async: false, logging: false, removeContainer:false}).then(canvas => {
                //console.log(imgc);
                var imgc = canvas.toDataURL();
                //console.log(imgc);
                calendariocanvas.push(imgc);
                anoscanvas.shift();
                if (anoscanvas.length > 0) {
                        CanvasYear(anoscanvas[0]);
                }
                else {
                    //console.log('acabou ! manda print');
                    PrintTwo();
                }
            });

        }

        function cloneme(obj) {
            console.log(obj);
        }

        function PrintTwo() {

            //var div = document.querySelector("#print")
            var dateI = $('#datainicial').val().split('-');
            var dataI = [dateI[2], dateI[1], dateI[0]].join('/');

            var dateF = $('#datafinal').val().split('-');
            var dataF = [dateF[2], dateF[1], dateF[0]].join('/');

            var extras = '';// 'Semanas iniciais e Encontro complementares Online';


            //html2canvas(div, {
                //windowWidth: 1200 //,height: 1200
           // }).then(canvas => {
                //var myImage = canvas.toDataURL();
            var docDefinition = {
                pageSize: 'A4',
                pageOrientation: 'portrait',
                pageMargins: [40, 60, 40, 50],
                header: {
                    margin: 8,
                    table: {
                        widths: [100, '*'],

                        body: [
                            [
                                {
                                    image: 'data:image/png;base64,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',
                                    width: 50

                                },
                                { text: '\n  Anexo II do contrato de aprendizagem firmado entre as partes abaixo enunciadas, em atendimento à Lei da Aprendizagem 10.097/2000 e Portaria 671/2021', width: '*' }

                            ]
                        ]
                    },
                    layout: 'noBorders'
                },
                footer: function (currentPage, pageCount) {
                    var resp = [];
                    if (currentPage == pageCount) {
                        resp.push({
                            alignment: 'center',
                            columns: [{ text: '______________________________________________________________',  width: '*', fontSize: 8, margin: [5, 2] },
                                      { text: '______________________________________________________________',  width: '*', fontSize: 8, margin: [5, 2] }
                            ]
                        });
                        resp.push({
                            alignment: 'center',
                            columns: [{ text: 'GERAR', width: '*', fontSize: 8, margin: [5, 2] },
                                      { text: $('#aprendiz').val(), width: '*', fontSize: 8, margin: [5, 2] }
                            ]
                        });

                    } else {
                        resp.push({ text: ' ', alignment: 'center', width: '*', fontSize: 8, margin: [5, 2] });
                        resp.push({ text: ' ', alignment: 'center', width: '*', fontSize: 8, margin: [5, 2] });
                    }
                    resp.push({ text: 'Página ' + currentPage + ' de ' + pageCount, alignment: 'right', width: '*', fontSize: 8, margin: [5, 2] })
                    return resp;
                    },
                    content: [
                        // if you don't need styles, you can use a simple string to define a paragraph
                        { text: 'Local: ' + $('#idcidade option:selected').text(), fontSize: 10 },
                        { text: 'Empresa: ' + $('#empresa').val() },
                        { text: 'Aprendiz: ' + $('#aprendiz').val() },
                        {
                            alignment: 'left',
                            columns: [
                                {
                                    width: 120,
                                    text: 'Data Inicial: ' + dataI //+ '\n'+'Dia semana Teoria: ' + $('#semanateoria option:selected').text()
                                },
                                {
                                    width: 120,
                                    text: 'Data Final: ' + dataF
                                },
                                {
                                    width: 120,
                                    text: 'Total Meses: ' + $('#mesestotal').val()
                                },
                                {
                                    width: '*',
                                    text: 'Dia semana Teoria: ' + $('#semanateoria option:selected').text()
                                },
                            ]
                        },
                        {
                            alignment: 'left',
                            columns: [
                                
                                {
                                    width: 120,
                                    text: 'Carga Horária dia: ' + $('#cargahoraria option:selected').text().split(' ')[0]
                                }
                                ,
                                {
                                    width: 120,
                                    text: 'Carga Inicial: ' + $('#cargainicial').val()
                                },
                                {   width: 120,
                                    text: 'Carga Teoria: ' + $('#cargateorica').val() + ' Hs'
                                },
                                {   width: '*',
                                    text: 'Carga Prática: ' + $('#cargapratica').val() + ' Hs'
                                }
                            ]
                        }
                    ],
                    styles: {
                        rightme:
                        {
                            alignment: 'right'
                        },
                        centerme:
                        {
                            alignment: 'center'
                        }

                    },
                     defaultStyle: {
                         fontSize: 09,
                    }
                };
            calendariocanvas.forEach(p => {
                docDefinition.content.push({
                    image: p,
                    width: 500,
                    alignment: 'center'
                    //,pageBreak: 'after'
                });
            });
            if (calendario.suspensao != null) {
                calendario.suspensao.forEach(p => {
                    var dateI = p.datainicial.split('-');
                    dateI = [dateI[2].replace('T00:00:00', ''), dateI[1], dateI[0]].join('/');
                    var dateF = p.datafinal.split('-');
                    dateF = [dateF[2].replace('T00:00:00', ''), dateF[1], dateF[0]].join('/');
                    docDefinition.content.push(
                        {
                            alignment: 'left',
                            columns: [
                                {
                                    width: '*',
                                    text: 'Período de Suspensão: ' + dateI + ' até ' + dateF
                                }

                            ]
                        }
                    );
                });
            }
            var columns = [];
            var iniciais = '';
            if (calendario.iniciais != null)
            {
                iniciais = 'Semanas iniciais \n Carga Inicial: ' + $("#cargainicial").val() +'\n';
                calendario.iniciais.forEach(p => {
                    iniciais += p.datainicial.slice(0, 10).split('-').reverse().join('/') + ' até ' + p.datafinal.slice(0, 10).split('-').reverse().join('/') + '\n';
                });
                iniciais = {
                    width: 135,
                    text: iniciais
                };
                columns.push(iniciais);
            }
            var extras = '';
            if (calendario.extras != null)
            {
                extras = 'Encontro complementares Online\n';
                calendario.extras.forEach(p => {
                    extras += p.datainicial.slice(0, 10).split('-').reverse().join('/') + ' até ' + p.datafinal.slice(0, 10).split('-').reverse().join('/') + '\n';
                });
                extras = {
                    width: 135,
                    text: extras
                };
                columns.push(extras);
            }
            var ferias = '';
            if (calendario.ferias != null) {
                ferias = 'Período de férias \n';
                calendario.ferias.forEach(p => {
                ferias+= p.datainicial.slice(0, 10).split('-').reverse().join('/') + ' até ' + p.datafinal.slice(0, 10).split('-').reverse().join('/') + '\n';
                });
                ferias={
                    width: 135,
                    text: ferias
                };
                columns.push(ferias);
            }
            var suspensao = '';
            if (calendario.suspensao != null) {
                suspensao = 'Período de suspensão \n';
                calendario.suspensao.forEach(p => {
                    suspensao += p.datainicial.slice(0, 10).split('-').reverse().join('/') + ' até ' + p.datafinal.slice(0, 10).split('-').reverse().join('/') + '\n';
                });
                suspensao = {
                    width: 135,
                    text: suspensao
                };
                columns.push(suspensao);
            }
            var estabilidadesuspencaodias = '';
            if (calendario.estabilidadesuspencaodias != null) {
                estabilidadesuspencaodias = 'Período de estabilidade \n';
                calendario.estabilidadesuspencaodias.forEach(p => {
                    estabilidadesuspencaodias += p.datainicial.slice(0, 10).split('-').reverse().join('/') + ' até ' + p.datafinal.slice(0, 10).split('-').reverse().join('/') + '\n';
                });
                estabilidadesuspencaodias = {
                    width: 135,
                    text: estabilidadesuspencaodias
                };
                columns.push(estabilidadesuspencaodias);
            }
            if ($('#reducaoper:checked').val() > 0 && calendario.reducao != null) {
                calendario.reducao.forEach(p => {
                    var dateI = p.datainicial.split('-');
                    dateI = [dateI[2].replace('T00:00:00', ''), dateI[1], dateI[0]].join('/');
                    var dateF = p.datafinal.split('-');
                    dateF = [dateF[2].replace('T00:00:00', ''), dateF[1], dateF[0]].join('/');
                    columns.push(
                        {
                            alignment: 'left',
                            columns: [
                                {
                                    width: '*',
                                    text: 'Redução de ' + $('#reducaoper:checked').val() + '% no período de ' + dateI + ' até ' + dateF
                                }

                            ]
                        }
                    );
                });
            }

            if (columns.length > 0) {
            docDefinition.content.push(
                { pageBreak: 'before', margin: 10, text: 'CRONOGRAMA DE ENCONTROS', width: '*', alignment: 'center', fontSize: 12},
                    {
                        margin: 1,
                        alignment: 'center',
                        columns: columns
                    })
            }
                // open the PDF in a new window
            //pdfMake.createPdf(docDefinition).open();
            pdfMake.createPdf(docDefinition).download(guid()+'.pdf');
            hideLoader();
            // print the PDF
            //pdfMake.createPdf(docDefinition).print();
            // download the PDF
            //pdfMake.createPdf(docDefinition).download('cal.pdf');
           // });
        }

        function guid() {
            return "ss-s-s-s-sss".replace(/s/g, s4);
        }

        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000)
                .toString(16)
                .substring(1);
        }

        function showLoader() {
            document.getElementById("loader").style.display = "block";
            //document.getElementById("myDiv").style.display = "none";
            //document.getElementsByTagName('body')[0];
            $('#mypanel').addClass('disabledbutton');
        }
        function hideLoader() {
            document.getElementById("loader").style.display = "none";
            //document.getElementById("myDiv").style.display = "none";
            //document.getElementsByTagName('body')[0];
            $('#mypanel').removeClass('disabledbutton');
        }
        function log() {

            var logWS = XLSX.utils.json_to_sheet(calendario.log);
            var wb = XLSX.utils.book_new(); // make Workbook of Excel
            XLSX.utils.book_append_sheet(wb, logWS, 'log');
            XLSX.writeFile(wb, 'log.xlsx');

      //$(".dataTables_empty").empty();
      //var elt = document.getElementById('dt');
      //var wb = XLSX.utils.table_to_book(elt, { sheet: 'Jovens' });
      //XLSX.writeFile(wb, ('Jovens.xlsx'));
        }
        function download(content, fileName, contentType) {
            var a = document.createElement("a");
            var file = new Blob([content], { type: contentType });
            a.href = URL.createObjectURL(file);
            a.download = fileName;
            a.click();
            a.remove();
        }
        document.getElementById('Fcalendarbkp')
            .addEventListener('change', function () {

                var fr = new FileReader();
                fr.onload = function () {
                    calendar=JSON.parse(fr.result);
                }

                fr.readAsText(this.files[0]);
            })
        /******************************************/
        var app = new Vue(
            {
                el: '#app',
                data: {
                    message: '',
                    iniciais: calendario.iniciais
                }
            }
        );

        function addCH()
        {
            var horasteoricas=0;
            var horaspraticas=0

            $('.month').each(function(i,obj){ 
             var ano= $('.year-title').eq(2).text();
             var mes= i+1; 
             var day = lastday(ano,i)
             if(mes<10)
             {mes='0'+mes;}
             var filtro=day+'/'+mes+'/'+ano;
             var l=calendario.log.find(x=>x.day==filtro);                
            if(l !=undefined)
            {
                if(mes==1){//verifica se tem acumulado ano anterior
                var anoanterior = calendario.log.find(x=>x.day=='31/12/'+(ano-1));
                if(anoanterior){
                    horasteoricas=anoanterior.horasteoricas;
                    horaspraticas=anoanterior.horaspraticas;
                }
                }

                var teoricas= l.horasteoricas-horasteoricas;
                var praticas= l.horaspraticas-horaspraticas;
                $(this).find('tr:last').after('<tr><td colspan="7" class="chrow" >CH teórica:<b>'+teoricas+'</b> CH prática:<b>'+ praticas+'</b></td></tr>')
                horasteoricas=l.horasteoricas;
                horaspraticas=l.horaspraticas;
             }
            });
        }
        var lastday = function(y,m){
        return  new Date(y, m +1, 0).getDate();
        }


        function cargahorariaChange(){
            let value = $('#cargahoraria').val()!='4' && $('#cargahoraria').val()!='5';
            $('#cargateorica').prop('readonly', value );    
            $('#cargapratica').prop('readonly', value );   
            
            UpdateCalendario();
            }

            function checkdiafolga(){
                if ($('#diafolga').val() == $('#semanateoria').val()) {
                    $('#diafolga').val("6");
                    return false;
                }
                
            }
    </script>

}